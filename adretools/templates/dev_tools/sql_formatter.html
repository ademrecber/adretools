{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'core:home' %}">{% trans "Home" %}</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'dev_tools:home' %}">{% trans "Developer Tools" %}</a></li>
                    <li class="breadcrumb-item active">{% trans "SQL Formatter" %}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">{% trans "SQL Formatter" %}</h1>
            <p class="lead">{% trans "Format and beautify SQL queries online for free" %}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>{% trans "SQL Input" %}</h5>
                </div>
                <div class="card-body">
                    <textarea id="inputText" class="form-control" rows="10" placeholder="{% trans 'Enter SQL query to format...' %}"></textarea>
                    <div class="mt-3">
                        <button id="formatBtn" class="btn btn-primary me-2">{% trans "Format" %}</button>
                        <button id="minifyBtn" class="btn btn-secondary">{% trans "Minify" %}</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>{% trans "Formatted SQL" %}</h5>
                </div>
                <div class="card-body">
                    <textarea id="resultText" class="form-control" rows="10" readonly></textarea>
                    <div class="mt-3">
                        <button id="copyBtn" class="btn btn-success">{% trans "Copy" %}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputText = document.getElementById('inputText');
    const resultText = document.getElementById('resultText');
    const formatBtn = document.getElementById('formatBtn');
    const minifyBtn = document.getElementById('minifyBtn');
    const copyBtn = document.getElementById('copyBtn');

    async function processSQL(action) {
        const sql = inputText.value.trim();
        if (!sql) {
            alert('{% trans "Please enter SQL query!" %}');
            return;
        }

        try {
            const response = await fetch('{% url "dev_tools:sql_formatter_api" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    sql_text: sql,
                    action: action
                })
            });

            const data = await response.json();
            
            if (response.ok) {
                resultText.value = data.result;
            } else {
                alert(data.error || '{% trans "An error occurred" %}');
            }
        } catch (error) {
            alert('{% trans "Connection error" %}');
        }
    }

    formatBtn.addEventListener('click', () => processSQL('format'));
    minifyBtn.addEventListener('click', () => processSQL('minify'));

    copyBtn.addEventListener('click', function() {
        if (resultText.value) {
            navigator.clipboard.writeText(resultText.value);
            alert('{% trans "Copied!" %}');
        }
    });
});
</script>
{% endblock %}